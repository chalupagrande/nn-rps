{"version":3,"sources":["app.js"],"names":["sessionId","slackURI","endpoint","myInit","headers","mode","cache","stats","win","tie","loss","total","counting","buttons","document","querySelectorAll","forEach","b","addEventListener","e","preventDefault","val","target","value","handleVote","window","key","vote","keyCode","hv","cv","chooseRandom","r","determineWinner","updateStats","sendResults","countDown","humanVote","compVote","result","count","updateWinLossColors","id","setInterval","run","clearInterval","finishScreen","querySelector","innerText","updateStatsScreen","updateMoves","payload","JSON","stringify","game","method","body","fetch","then","res","json","console","log","success","handleServerError","msg","catch","err","alert","text","p","classList","remove","add","h","c","toUpperCase","hc","createElement","cc","hl","cl","childElementCount","children","prepend","c1","c2","choices","Math","floor","random","n","t","round","fetchSessionId"],"mappings":";;AAAA,IAAIA,YAAY,CAAhB;AACA,IAAIC,WAAW,EAAf;AACA,IAAMC,WAAW,OAAjB;AACA,IAAIC,SAAS;AACXC,WAAS;AACH,cAAU,mCADP;AAEH,oBAAgB;AAFb,GADE;AAKXC,QAAM,MALK;AAMXC,SAAO;AANI,CAAb;AAQA,IAAMC,QAAQ;AACZC,OAAK,CADO;AAEZC,OAAK,CAFO;AAGZC,QAAM,CAHM;AAIZC,SAAO;AAJK,CAAd;AAMA,IAAIC,WAAW,KAAf;AACA;;AAEA;AACA,IAAMC,UAAUC,SAASC,gBAAT,CAA0B,QAA1B,CAAhB;AACAF,QAAQG,OAAR,CAAgB;AAAA,SAAGC,EAAEC,gBAAF,CAAmB,OAAnB,EAA4B,UAACC,CAAD,EAAK;AAClDA,MAAEC,cAAF;AACA,QAAIC,MAAMF,EAAEG,MAAF,CAASC,KAAnB;AACA,QAAG,CAACX,QAAJ,EAAcY,WAAWH,GAAX;AACf,GAJkB,CAAH;AAAA,CAAhB;;AAMAI,OAAOP,gBAAP,CAAwB,SAAxB,EAAmC,aAAG;AACpC,MAAMQ,MAAM,EAAC,IAAI,MAAL,EAAY,IAAG,MAAf;AACF,QAAI,OADF,EACW,IAAI,OADf;AAEF,QAAI,UAFF,EAEc,IAAI,UAFlB,EAAZ;AAGA,MAAMC,OAAOD,IAAIP,EAAES,OAAN,CAAb;AACA,MAAGD,QAAQ,CAACf,QAAZ,EAAsBY,WAAWG,IAAX;AACvB,CAND;;AAQA;AACA,SAASH,UAAT,CAAoBK,EAApB,EAAuB;AACrB,MAAG,CAACjB,QAAJ,EAAa;AACX,QAAIkB,KAAKC,cAAT;AACA,QAAIC,IAAIC,gBAAgBJ,EAAhB,EAAoBC,EAApB,CAAR;AACAI,gBAAYF,CAAZ;AACAG,gBAAYN,EAAZ,EAAgBC,EAAhB;AACAM,cAAUP,EAAV,EAAcC,EAAd,EAAkBE,CAAlB;AACD;AACF;;AAED,SAASI,SAAT,CAAmBC,SAAnB,EAA8BC,QAA9B,EAAwCC,MAAxC,EAA+C;AAC7C3B,aAAW,IAAX;AACA,MAAI4B,QAAQ,CAAZ;AACAC,sBAAoB,CAApB;AACA,MAAMC,KAAKC,YAAYC,GAAZ,EAAiB,GAAjB,CAAX;AACAA;AACA,WAASA,GAAT,GAAc;AACZ,QAAGJ,SAAS,CAAZ,EAAc;AACZf,aAAOoB,aAAP,CAAqBH,EAArB;AACAI,mBAAaT,SAAb,EAAwBC,QAAxB,EAAkCC,MAAlC;AACA3B,iBAAW,KAAX;AACD,KAJD,MAIO;AACLE,eAASiC,aAAT,CAAuB,eAAvB,EAAwCC,SAAxC,GAAoDR,KAApD;AACA1B,eAASiC,aAAT,CAAuB,kBAAvB,EAA2CC,SAA3C,GAAuDR,KAAvD;AACD;AACDA,aAAS,CAAT;AACD;AACF;;AAED,SAASM,YAAT,CAAsBT,SAAtB,EAAiCC,QAAjC,EAA2CC,MAA3C,EAAkD;AAChDU,oBAAkBV,MAAlB;AACAW,cAAYb,SAAZ,EAAuBC,QAAvB,EAAiCC,MAAjC;AACD;;AAED,SAASJ,WAAT,CAAqBN,EAArB,EAAwBC,EAAxB,EAA2B;AACzB,MAAIqB,UAAUC,KAAKC,SAAL,CAAe;AAC3BC,UAAM,CAACzB,EAAD,EAAKC,EAAL,CADqB;AAE3B9B,wBAF2B;AAG3BO;AAH2B,GAAf,CAAd;AAKA;AACAJ,SAAOoD,MAAP,GAAgB,MAAhB;AACApD,SAAOqD,IAAP,GAAcL,OAAd;;AAEAM,QAAMvD,WAAS,OAAf,EAAwBC,MAAxB,EACCuD,IADD,CACM,UAACC,GAAD,EAAO;AACX,WAAOA,IAAIC,IAAJ,EAAP;AACD,GAHD,EAICF,IAJD,CAIM,UAACE,IAAD,EAAQ;AACZC,YAAQC,GAAR,CAAYF,IAAZ;AACA,QAAG,CAACA,KAAKG,OAAT,EAAkBC,kBAAkBJ,KAAKK,GAAvB;AACnB,GAPD,EAQCC,KARD,CAQO;AAAA,WAAOF,kBAAkBG,GAAlB,CAAP;AAAA,GARP;AASD;;AAED,SAASH,iBAAT,CAA2BG,GAA3B,EAA+B;AAC7B,MAAG,OAAOA,GAAP,KAAe,QAAlB,EAA4BA,MAAM,UAAUf,KAAKC,SAAL,CAAec,GAAf,CAAV,GAAgC,OAAtC;AAC5BC,QAAM,+CAAN;AACAjE,SAAOoD,MAAP,GAAgB,MAAhB;AACApD,SAAOgD,OAAP,GAAiB,EAACkB,MAAMF,GAAP,EAAjB;AACAV,QAAMxD,QAAN,EAAgBE,MAAhB,EACG+D,KADH,CACS;AAAA,WAAOL,QAAQC,GAAR,CAAYK,GAAZ,CAAP;AAAA,GADT;AAED;;AAGDH,kBAAkB,OAAlB;;AAEA,SAAS9B,WAAT,CAAqBK,MAArB,EAA4B;AAC1B,MAAGA,UAAU,CAAb,EAAgBhC,MAAMC,GAAN,IAAY,CAAZ,CAAhB,KACK,IAAG+B,UAAU,CAAb,EAAgBhC,MAAME,GAAN,IAAY,CAAZ,CAAhB,KACAF,MAAMG,IAAN,IAAa,CAAb;AACLH,QAAMI,KAAN,IAAc,CAAd;AACD;;AAED,SAASsC,iBAAT,GAA4B;AAC1BnC,WAASiC,aAAT,CAAuB,mBAAvB,EAA4CC,SAA5C,GAAwDzC,MAAMC,GAA9D;AACAM,WAASiC,aAAT,CAAuB,mBAAvB,EAA4CC,SAA5C,GAAwDzC,MAAME,GAA9D;AACAK,WAASiC,aAAT,CAAuB,oBAAvB,EAA6CC,SAA7C,GAAyDzC,MAAMG,IAA/D;;AAEAI,WAASiC,aAAT,CAAuB,uBAAvB,EAAgDC,SAAhD,GAA4DsB,EAAE/D,MAAMC,GAAR,EAAaD,MAAMI,KAAnB,CAA5D;AACAG,WAASiC,aAAT,CAAuB,uBAAvB,EAAgDC,SAAhD,GAA4DsB,EAAE/D,MAAME,GAAR,EAAaF,MAAMI,KAAnB,CAA5D;AACAG,WAASiC,aAAT,CAAuB,wBAAvB,EAAiDC,SAAjD,GAA6DsB,EAAE/D,MAAMG,IAAR,EAAcH,MAAMI,KAApB,CAA7D;AACD;;AAED;AACA,SAAS8B,mBAAT,CAA6BT,CAA7B,EAA+B;AAC7B,MAAIH,KAAKf,SAASiC,aAAT,CAAuB,eAAvB,CAAT;AACA,MAAIjB,KAAKhB,SAASiC,aAAT,CAAuB,kBAAvB,CAAT;AACA,MAAGf,KAAI,CAAP,EAAS;AACPH,OAAG0C,SAAH,CAAaC,MAAb,CAAoB,MAApB;AACA3C,OAAG0C,SAAH,CAAaE,GAAb,CAAiB,KAAjB;AACA3C,OAAGyC,SAAH,CAAaC,MAAb,CAAoB,KAApB;AACA1C,OAAGyC,SAAH,CAAaE,GAAb,CAAiB,MAAjB;AACD,GALD,MAKO,IAAGzC,KAAI,CAAP,EAAU;AACfH,OAAG0C,SAAH,CAAaC,MAAb,CAAoB,MAApB;AACA3C,OAAG0C,SAAH,CAAaC,MAAb,CAAoB,KAApB;AACA1C,OAAGyC,SAAH,CAAaC,MAAb,CAAoB,KAApB;AACA1C,OAAGyC,SAAH,CAAaC,MAAb,CAAoB,MAApB;AACD,GALM,MAKA;AACL3C,OAAG0C,SAAH,CAAaC,MAAb,CAAoB,KAApB;AACA3C,OAAG0C,SAAH,CAAaE,GAAb,CAAiB,MAAjB;AACA3C,OAAGyC,SAAH,CAAaC,MAAb,CAAoB,MAApB;AACA1C,OAAGyC,SAAH,CAAaE,GAAb,CAAiB,KAAjB;AACD;AACF;;AAED;AACA,SAASvB,WAAT,CAAqBwB,CAArB,EAAuBC,CAAvB,EAAyB3C,CAAzB,EAA2B;AACzB0C,MAAIA,EAAEE,WAAF,EAAJ;AACAD,MAAIA,EAAEC,WAAF,EAAJ;AACAnC,sBAAoBT,CAApB;AACAlB,WAASiC,aAAT,CAAuB,eAAvB,EAAwCC,SAAxC,GAAoD0B,CAApD;AACA5D,WAASiC,aAAT,CAAuB,kBAAvB,EAA2CC,SAA3C,GAAuD2B,CAAvD;;AAEA,MAAIE,KAAK/D,SAASgE,aAAT,CAAuB,IAAvB,CAAT;AACAD,KAAG7B,SAAH,GAAe0B,CAAf;AACA,MAAIK,KAAKjE,SAASgE,aAAT,CAAuB,IAAvB,CAAT;AACAC,KAAG/B,SAAH,GAAe2B,CAAf;;AAEA,MAAIK,KAAKlE,SAASiC,aAAT,CAAuB,kBAAvB,CAAT;AACA,MAAIkC,KAAKnE,SAASiC,aAAT,CAAuB,qBAAvB,CAAT;;AAEA;AACA,MAAGiC,GAAGE,iBAAH,IAAwB,EAA3B,EAA8B;AAC5BF,OAAGG,QAAH,CAAY,CAAZ,EAAeX,MAAf;AACAS,OAAGE,QAAH,CAAY,CAAZ,EAAeX,MAAf;AACD;AACDQ,KAAGI,OAAH,CAAWP,EAAX;AACAI,KAAGG,OAAH,CAAWL,EAAX;AACD;;AAED,SAAS9C,eAAT,CAAyBoD,EAAzB,EAA6BC,EAA7B,EAAgC;AAC9B,MAAGD,MAAM,MAAT,EAAgB;AACd,QAAGC,MAAM,MAAT,EAAiB,OAAO,CAAP;AACjB,QAAGA,MAAM,UAAT,EAAqB,OAAO,CAAP;AACrB,QAAGA,MAAM,OAAT,EAAkB,OAAO,CAAC,CAAR;AACnB,GAJD,MAKK,IAAGD,MAAM,OAAT,EAAiB;AACpB,QAAGC,MAAM,OAAT,EAAkB,OAAO,CAAP,CAAlB,KACK,IAAGA,MAAM,MAAT,EAAiB,OAAO,CAAP,CAAjB,KACA,IAAGA,MAAM,UAAT,EAAqB,OAAO,CAAC,CAAR;AAC3B,GAJI,MAKA,IAAGD,MAAM,UAAT,EAAoB;AACvB,QAAGC,MAAM,UAAT,EAAqB,OAAO,CAAP,CAArB,KACK,IAAGA,MAAM,OAAT,EAAkB,OAAO,CAAP,CAAlB,KACA,IAAGA,MAAM,MAAT,EAAiB,OAAO,CAAC,CAAR;AACvB;AACF;;AAED;AACA,SAASvD,YAAT,GAAuB;AACrB,MAAMwD,UAAU,CAAC,MAAD,EAAS,OAAT,EAAkB,UAAlB,CAAhB;AACA,SAAOA,QAAQC,KAAKC,KAAL,CAAWD,KAAKE,MAAL,KAAc,CAAzB,CAAR,CAAP;AACD;;AAED;AACA;AACA,SAASpB,CAAT,CAAWqB,CAAX,EAAaC,CAAb,EAAe;AACb,SAAOJ,KAAKK,KAAL,CAAaF,IAAEC,CAAH,GAAM,IAAP,GAAa,EAAxB,IAA8B,GAArC;AACD;;AAGD,SAASE,cAAT,GAAyB;AACvB3F,SAAOoD,MAAP,GAAgB,KAAhB;AACAE,QAAMvD,WAAS,SAAf,EAA0BC,MAA1B,EACGuD,IADH,CACQ;AAAA,WAAG1B,EAAE4B,IAAF,EAAH;AAAA,GADR,EAEGF,IAFH,CAEQ,aAAG;AACP1D,gBAAYgC,EAAEhC,SAAd;AACAC,eAAW+B,EAAE/B,QAAb;AACD,GALH;AAMD;;AAED6F","file":"app.js","sourcesContent":["let sessionId = 0\nlet slackURI = ''\nconst endpoint = '/api/'\nlet myInit = { \n  headers: {\n        'Accept': 'application/json, text/plain, */*',\n        'Content-Type': 'application/json'\n    },\n  mode: 'cors',\n  cache: 'default'\n};\nconst stats = {\n  win: 0,\n  tie: 0,\n  loss: 0,\n  total: 0\n}\nlet counting = false\n// ^^^^ prevents multiple votes during countdown\n\n// Event Listeners\nconst buttons = document.querySelectorAll('button')\nbuttons.forEach(b=>b.addEventListener('click', (e)=>{\n  e.preventDefault()\n  let val = e.target.value\n  if(!counting) handleVote(val)\n}))\n\nwindow.addEventListener('keydown', e=>{\n  const key = {37: 'rock',82:'rock',\n            80: 'paper', 40: 'paper',\n            83: 'scissors', 39: 'scissors'}\n  const vote = key[e.keyCode]\n  if(vote && !counting) handleVote(vote)\n})\n\n// Runner Functions\nfunction handleVote(hv){\n  if(!counting){\n    let cv = chooseRandom()\n    let r = determineWinner(hv, cv)\n    updateStats(r)\n    sendResults(hv, cv)\n    countDown(hv, cv, r)\n  }\n}\n\nfunction countDown(humanVote, compVote, result){\n  counting = true\n  let count = 3\n  updateWinLossColors(0)\n  const id = setInterval(run, 700)\n  run()\n  function run(){\n    if(count == 0){\n      window.clearInterval(id)\n      finishScreen(humanVote, compVote, result)\n      counting = false\n    } else {\n      document.querySelector('.choice.human').innerText = count\n      document.querySelector('.choice.computer').innerText = count\n    }\n    count -= 1\n  }\n}\n\nfunction finishScreen(humanVote, compVote, result){\n  updateStatsScreen(result)\n  updateMoves(humanVote, compVote, result)\n}\n\nfunction sendResults(hv,cv){\n  let payload = JSON.stringify({\n    game: [hv, cv],\n    sessionId,\n    stats\n  })\n  //make request. \n  myInit.method = 'POST'\n  myInit.body = payload\n\n  fetch(endpoint+'entry', myInit)\n  .then((res)=>{\n    return res.json()\n  })\n  .then((json)=>{\n    console.log(json)\n    if(!json.success) handleServerError(json.msg)\n  })\n  .catch(err => handleServerError(err))\n}\n\nfunction handleServerError(err){\n  if(typeof err !== 'string') err = \"```\\n\" + JSON.stringify(err) + \"\\n```\"\n  alert('There was a problem connecting to the server.')\n  myInit.method = 'POST'\n  myInit.payload = {text: err}\n  fetch(slackURI, myInit)\n    .catch(err => console.log(err))\n}\n\n\nhandleServerError('jamie')\n\nfunction updateStats(result){\n  if(result >= 1) stats.win +=1;\n  else if(result == 0) stats.tie +=1;\n  else stats.loss +=1;\n  stats.total +=1\n}\n\nfunction updateStatsScreen(){\n  document.querySelector('.stat--number.win').innerText = stats.win\n  document.querySelector('.stat--number.tie').innerText = stats.tie\n  document.querySelector('.stat--number.loss').innerText = stats.loss\n\n  document.querySelector('.stat--percentage.win').innerText = p(stats.win, stats.total)\n  document.querySelector('.stat--percentage.tie').innerText = p(stats.tie, stats.total)\n  document.querySelector('.stat--percentage.loss').innerText = p(stats.loss, stats.total)\n}\n\n// Change the Colors of the Play depending on WIN or LOSS\nfunction updateWinLossColors(r){\n  let hv = document.querySelector('.choice.human')\n  let cv = document.querySelector('.choice.computer')\n  if(r >=1){ \n    hv.classList.remove('loss')\n    hv.classList.add('win')\n    cv.classList.remove('win')\n    cv.classList.add('loss')\n  } else if(r ==0) {\n    hv.classList.remove('loss')\n    hv.classList.remove('win')\n    cv.classList.remove('win')\n    cv.classList.remove('loss')\n  } else {\n    hv.classList.remove('win')\n    hv.classList.add('loss')\n    cv.classList.remove('loss')\n    cv.classList.add('win')\n  }\n}\n\n// Update Previous Moves List\nfunction updateMoves(h,c,r){\n  h = h.toUpperCase()\n  c = c.toUpperCase()\n  updateWinLossColors(r)\n  document.querySelector('.choice.human').innerText = h\n  document.querySelector('.choice.computer').innerText = c\n  \n  let hc = document.createElement('li')\n  hc.innerText = h\n  let cc = document.createElement('li')\n  cc.innerText = c\n\n  let hl = document.querySelector('.move-list.human')\n  let cl = document.querySelector('.move-list.computer')\n\n  //cap the moves list to 10\n  if(hl.childElementCount >= 10){\n    hl.children[9].remove()\n    cl.children[9].remove()\n  }\n  hl.prepend(hc)\n  cl.prepend(cc)\n}\n\nfunction determineWinner(c1, c2){\n  if(c1 == 'rock'){\n    if(c2 == 'rock') return 0\n    if(c2 == 'scissors') return 1\n    if(c2 == 'paper') return -1\n  }\n  else if(c1 == 'paper'){\n    if(c2 == 'paper') return 0\n    else if(c2 == 'rock') return 1\n    else if(c2 == 'scissors') return -1\n  }\n  else if(c1 == 'scissors'){\n    if(c2 == 'scissors') return 0\n    else if(c2 == 'paper') return 1\n    else if(c2 == 'rock') return -1\n  }\n}\n\n// Choose random play. Rock, Paper, or Scissors\nfunction chooseRandom(){\n  const choices = ['rock', 'paper', 'scissors']\n  return choices[Math.floor(Math.random()*3)]\n}\n\n// Helper functions\n//conver to percent\nfunction p(n,t){\n  return Math.round(((n/t)*1000)/10) + '%'\n}\n\n\nfunction fetchSessionId(){\n  myInit.method = 'GET'\n  fetch(endpoint+'session', myInit)\n    .then(r=>r.json())\n    .then(r=>{\n      sessionId = r.sessionId\n      slackURI = r.slackURI\n    })\n}\n\nfetchSessionId()"]}